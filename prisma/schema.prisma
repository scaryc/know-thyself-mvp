// Database structure for our medical training app

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// A training session (one student doing one scenario)
model Session {
  id            String         @id @default(uuid())
  userId        String         @default("demo-user")
  scenarioType  String         // "ami" for heart attack
  status        SessionStatus  @default(IN_PROGRESS)
  startedAt     DateTime       @default(now())
  completedAt   DateTime?
  
  // Connected data
  messages      Message[]
  vitalSigns    VitalSignsLog[]
  performance   PerformanceData?
}

// Session can be: in progress, paused, completed, or abandoned
enum SessionStatus {
  IN_PROGRESS
  PAUSED
  COMPLETED
  ABANDONED
}

// Each message in the conversation
model Message {
  id          String   @id @default(uuid())
  sessionId   String
  role        String   // "user" or "assistant"
  content     String   @db.Text
  timestamp   DateTime @default(now())
  
  session     Session  @relation(fields: [sessionId], references: [id])
}

// Patient vital signs at different times
model VitalSignsLog {
  id            String   @id @default(uuid())
  sessionId     String
  timestamp     DateTime @default(now())
  
  bloodPressure String   // "168/94"
  heartRate     Int      // 102
  respRate      Int      // 22
  spO2          Int      // 94
  painScore     Int      // 8
  
  session       Session  @relation(fields: [sessionId], references: [id])
}

// Final performance scores
model PerformanceData {
  id                      String  @id @default(uuid())
  sessionId               String  @unique
  
  totalMessages           Int
  hintsUsed               Int
  completionRate          Float   // 0.0 to 1.0
  assessmentCompleteness  Float   // How thorough was student
  criticalActions         Json    // ["aspirin", "oxygen"]
  safetyScore             Float   // 0 to 100
  
  session                 Session @relation(fields: [sessionId], references: [id])
}